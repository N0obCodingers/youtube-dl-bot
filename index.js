const{Telegraf:Telegraf}=require("telegraf"),{Composer:Composer}=require("micro-bot"),glob=require("glob");require("dotenv").config();const sendResult=require("./functions/sendResult"),download=require("./functions/download"),upload=require("./functions/upload"),clearCache=require("./functions/clearCache"),NODE_ENV=process.env.NODE_ENV,BOT_TOKEN=process.env.BOT_TOKEN,API_ROOT=process.env.API_ROOT;let url,audioFileSize;switch(NODE_ENV){case"development":bot=new Telegraf(BOT_TOKEN,{telegram:{apiRoot:API_ROOT}});break;case"production":bot=new Composer}switch(bot.start((e=>e.replyWithMarkdown(`Halo ${e.from.first_name}, selamat datang di YT-DL Bot, kirim link video yang ingin anda unduh untuk mengunduh video tersebut.\n\n*PERHATIAN*: Dikarenakan storage hosting yang terbatas, maka kalian tidak dapat mengunduh video yang memiliki ukuran di atas *450 MB*`))),bot.command("help",(e=>e.reply("Anda hanya perlu mengirimkan link dari video yang ingin diunduh"))),bot.on("text",(e=>{url=e.message.text;const a=e.update.message.message_id;sendResult(url,e,a)})),bot.on("callback_query",(async e=>{e.deleteMessage(e.update.callback_query.message.message_id);const a=e.callbackQuery.data,{id:o,judul:n}=await download(url,a,e),t=await upload(o,n,a,e);clearCache(t,url)})),NODE_ENV){case"development":bot.launch();break;case"production":module.exports={bot:bot,options:{telegram:{apiRoot:API_ROOT}}}}process.once("SIGINT",(()=>bot.stop("SIGINT"))),process.once("SIGTERM",(()=>bot.stop("SIGTERM")));
